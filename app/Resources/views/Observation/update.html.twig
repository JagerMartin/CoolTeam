<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>Page de modification observation</title>


    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="{{ asset('css/observation.css') }}" rel="stylesheet"/>

    <!-- Besoin datepicker -->
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script> // Récupération de la route pour requête AJAX de suppression d'image
        var pictureDeletionPath = "{{ path('app_ajax_picture_delete') }}";
    </script>

    <script src="{{ asset('js/pictures.js') }}"></script>
    <!-- Besoin localisation -->
    <script src="http://maps.google.com/maps/api/js?key=AIzaSyA6jv-xrqUOdmXVq6BnYVYXVWnm0T1wSg4&sensor=false"></script>

    <script src="{{ asset('js/localization.js') }}"></script>


</head>

<body onload="codeUpdateLatLng();">


<h1 class="text-center">Modification d'une observation</h1>
<hr/>

<div class="row">
    <div class="col-sm-8 col-sm-offset-2">
        {% for message in app.session.flashbag.get('info') %}
            <div class="alert alert-info"><span class="glyphicon glyphicon-info-sign"></span> {{ message }}</div>
        {% endfor %}
        {% for message in app.session.flashbag.get('error') %}
            <div class="alert alert-danger"><span class="glyphicon glyphicon-warning-sign"></span> {{ message }}</div>
        {% endfor %}
    </div>
</div>

{{ form_stylesheet(form) }}

{{ form_javascript(form) }}
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-10 col-sm-offset-1">
            <h4>Nom : {{ observation.taxref.vernacularName }}</h4>
            <h4>Nom complet : {{ observation.taxref.fullName }}</h4>
            <h4>Famille : {{ observation.taxref.family }}</h4>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            {{ form_start(form) }}
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group">
                        {{ form_label(form.datetime, 'Date et heure' ) }}
                        {{ form_widget(form.datetime, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.datetime) }}
                    </div>
                    <div>
                        {{ form_label(form.sex, 'Sexe' ) }}
                        {{ form_widget(form.sex) }}
                        {{ form_errors(form.sex) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(form.observation, 'Observation' ) }}
                        {{ form_widget(form.observation, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.observation) }}
                    </div>
                    <div>
                        <button type="button" class="btn btn-primary" onclick="initialize()">Me Géolocaliser</button>
                    </div>
                    <div class="form-group">
                        {{ form_label(form.latitude, 'Latitude' ) }}
                        {{ form_widget(form.latitude, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.latitude) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(form.longitude, 'Longitude' ) }}
                        {{ form_widget(form.longitude, {'attr': {'class': 'form-control'}}) }}
                        {{ form_errors(form.longitude) }}
                    </div>
                    <div class="form-group">
                        {{ form_label(form.department, 'Département' ) }}
                        {{ form_widget(form.department, {'attr': {'class': 'form-control', 'readonly': 'readonly'}}) }}
                        {{ form_errors(form.department) }}
                    </div>
                    <div>
                        <button type="button" class="btn btn-primary" onclick="codeLatLng()">Voir sur la carte</button>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div id="map_canvas"></div>
                </div>
            </div>
            <hr/>
            <div class="row">
                <div class="col-sm-12">
                    <p>Photos (3 maximum) : </p>
                    <div class="row">
                    {% for picture in form.pictures %}
                        <div class="col-sm-2">
                            <div class="field_input_{{ loop.index0 }}">
                                {{ form_errors(picture.imageFile) }}
                                {% if picture.vars.value.imageFile == null %}
                                    {{ form_widget(picture.imageFile, { 'attr': {'class': 'input_file_' ~ loop.index0 ~ ' file_' ~ loop.index0 } } ) }}
                                {% else %}
                                    {{ form_widget(picture.imageFile, { 'attr': {'class': 'input_file_' ~ loop.index0 ~ ' file_' ~ loop.index0 ~ ' hidden'} } ) }}
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                    </div>
                    <div class="row">
                    {% for picture in observation.pictures %}
                        <div class="col-sm-2">
                            <div id="image_preview_file_{{ loop.index0 }}">
                                {% if picture.imageFile == null %}
                                <div class="thumbnail hidden">
                                {% else %}
                                <div class="thumbnail">
                                {% endif %}
                                    <img src="{{ '../../../' ~ vich_uploader_asset(picture, 'imageFile') }}"/>
                                    <div class="caption" id="picture_{{ picture.id }}">
                                        <button type="button" id="file_{{ loop.index0 }}"
                                                class="btn btn-danger deleteImageBtn">Supprimer
                                        </button>
                                        <p class="confirmDeletionBlock">
                                            Êtes-vous sûr de vouloir supprimer la photo ?<br/>
                                            <button type="button" id="file_{{ loop.index0 }}"
                                                    class="btn btn-warning confirmDeletionBtn">Confirmer
                                            </button>
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div id="image_preview_input_file_{{ loop.index0 }}" class="col-sm-12">
                                <div class="thumbnail hidden">
                                    <img src="http://placehold.it/5" alt="">
                                    <div class="caption">
                                        <p>
                                            <button type="button" id="input_file_{{ loop.index0 }}"
                                                    class="btn btn-default btn-danger">Annuler
                                            </button>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    </div>
                </div>
            </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
</div>
</body>

</html>